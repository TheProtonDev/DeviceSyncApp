<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>DeviceSync</title>
    <meta name="description" content="Cross Platform Multi-Device Clipboard Software">
    <meta name="" content="">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Risque&amp;display=swap">
    <link rel="stylesheet" href="assets/css/Sansation.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Share+Tech&amp;display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body style="background: linear-gradient(to right top, #241f31, #2e243f, #39284d, #462b5b, #542e68), rgba(255,255,255,0);background-repeat: inherit;">
    <div id="ifLoggedin" style="/*display: none;*//*visibility: hidden;*/">
        <h3 class="d-flex d-sm-flex justify-content-center align-items-center justify-content-sm-center" style="padding-top: 71px;font-family: 'Share Tech', sans-serif;color: #A441FF;">Upload</h3>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center justify-content-xxl-center" id="pasteTitlecenter" style="padding-bottom: 15px;padding-top: 11px;padding-right: 9px;"><textarea id="pasteTitle" placeholder="Paste Title" style="border-radius: 10px;border: none;padding-bottom: 8px;"></textarea>
</div>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center justify-content-xxl-center" id="pastecenter" style="padding-bottom: 15px;padding-top: 11px;padding-right: 9px;"><textarea id="paste" placeholder="Paste" style="border-radius: 10px;border: none;padding-bottom: 8px;"></textarea>
</div>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="uploadbtn" style="padding-bottom: 15px;"><script>
    function remove_linebreaks(str) {
        return str.replace( /[\r\n]+/gm, "" );
    }
    function tryUpload(){
      // Check if both fields are filled in
      const pasteTitle = document.getElementById("pasteTitle")
      const paste = document.getElementById("paste")
      // Return error toast notification if one of the fields or both fields are blank
      if (pasteTitle.value == "" || paste.value == ""){
          toast('error', 'Please enter both a paste title and a pase');
      }
      // If both fields are filled in and have sufficient data, proceed with trying to login
      else{
          toast('prompt', 'Processing Data');
          // Move on to processing data using checkLogin()
          upload(encodeURI(pasteTitle.value), encodeURI(paste.value))
      }
  }

  async function upload(title, paste) {
    const username = getCookie("username");
    const auth_token = getCookie("auth_token");
    let url = "https://devicesync-api.theprotondev.repl.co/upload?username="+username+'&auth_token='+auth_token+"&paste_title="+title+"&paste="+paste
    // Check result of json, return request result
    let jsonResult = await (await fetch(url)).json();

    if(jsonResult.Error){
      toast('error', jsonResult.Error);
    }
    else{ // On success
      //const username = jsonResult.username
      if(jsonResult.Success){
        toast('success', "Success: " + jsonResult.Success);
      }
    }
  }
</script>

<button class="btn btn-primary btn-grad" type="button" onclick="tryUpload()">Upload</button>
</div>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="backbtn" style="padding-bottom: 15px;"><button class="btn btn-primary btn-grad" type="button" onclick="window.location=&#39;home.html&#39;">Back</button></div>
    </div>
    <div id="ifNotloggedin" style="display: none;visibility: hidden;"><h3 class="text-center d-flex d-sm-flex justify-content-center align-items-center justify-content-sm-center" style="padding-top: 71px;font-family: 'Share Tech', sans-serif;color: #ff0000;">Hm, You're not supposed to be here<br />Redirecting In 3 Seconds...</h3>
</div>
    <footer style="padding-top: 167px;margin-bottom: 110px;"><script>
    // Wait till the site is loaded, once loaded check api status, also check if user signed in, if not redirect to index page
    window.addEventListener('load', function () {
        // Check if the user is signed in
        isLoggedIn();
        async function apiStatus() {
            let response = await fetch('https://devicesync-api.theprotondev.repl.co/status');
            const data = await response.text();
            const status_label = document.getElementById("api-status-label");
            status_label.innerText = data;
        }
        apiStatus()
    })
</script>

<h3 id="api-status-label" class="d-flex d-sm-flex justify-content-center align-items-center justify-content-sm-center" style="padding-bottom: 500px;font-family: 'Share Tech', sans-serif;color: #A441FF;height: 0px;">API Status: Down | Or Not Accessible</h3>
</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/protonSnippets.js"></script>
    <script src="assets/js/toast.min.js"></script>
</body>

</html>