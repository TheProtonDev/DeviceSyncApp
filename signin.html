<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>DeviceSync</title>
    <meta name="description" content="Cross Platform Multi-Device Clipboard Software">
    <meta name="" content="">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Risque&amp;display=swap">
    <link rel="stylesheet" href="assets/css/Sansation.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Share+Tech&amp;display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body style="background: linear-gradient(to right top, #241f31, #2e243f, #39284d, #462b5b, #542e68), rgba(255,255,255,0);background-repeat: inherit;">
    <h3 class="d-flex d-sm-flex justify-content-center align-items-center justify-content-sm-center" style="padding-top: 71px;font-family: 'Share Tech', sans-serif;color: #A441FF;">Sign In</h3>
    <p class="text-center d-flex flex-shrink-1 justify-content-center align-items-center" style="color: rgb(255,255,255);font-family: Sansation;"><span style="text-decoration: underline;">Please input your username&nbsp;and user id into the boxes below</span></p>
    <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="loginFormDiv" style="padding-bottom: 15px;">
        <form><input class="form-control" type="text" id="userField" placeholder="Username" style="border-radius: 10px;border: none;padding-bottom: 8px;"><br><input id="passwordField" class="form-control" type="password" placeholder="Password" style="border-radius: 10px;border: none;" /></form>
    </div>
    <div class="d-flex d-xl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center" id="CenterButton1"><script>
    function signIn(){
        // Check if both fields are filled in
        const usernameBox = document.getElementById("userField")
        const passwordBox = document.getElementById("passwordField")
        // Return error toast notification if one of the fields or both fields are blank
        if (usernameBox.value == "" || passwordBox.value == ""){
            toast('error', 'Please enter both a username and a userid');
        }
        else if(passwordBox.value.length < 8){
            toast('error', 'Your password should be exactly 8 characters | You Entered '+ passwordBox.value.length);
        }
        // If both fields are filled in and hsave sufficient data, proceed with trying to login
        else{
            toast('prompt', 'Processing Data');
            // Move on to processing data using checkLogin()
            checkLogin(usernameBox.value, passwordBox.value)
        }
    }

    async function checkLogin(username, password) {
      let url = "https://devicesync-api.theprotondev.repl.co/signin?username="+username+'&password='+password
      // Check result of json, return request result
      let jsonResult = await (await fetch(url)).json();

      if(jsonResult.Error){
        toast('error', jsonResult.Error);
      }
      else{ // On success
         const username = jsonResult.username
         const auth_token = jsonResult.auth_token
         toast('success', "Welcome Back, " + username);
         document.cookie = "username="+username+'; secure; SameSite=Strict';
         document.cookie = "auth_token="+auth_token+'; secure SameSite=Strict';
         window.location='index.html'
      }
    }
</script>
<button id="signInBTN" class="btn btn-primary btn-grad align-self-sm-center" onclick="signIn()" type="button">Sign In</button>
</div><br>
    <div class="d-flex justify-content-center align-items-center" id="CenterButton2"><button class="btn btn-primary btn-grad" type="button" onclick="window.location=&#39;index.html&#39;">Back</button></div>
    <footer style="padding-top: 167px;"><script>
  // Wait till the site is loaded, once loaded check api status, also check if user signed in, if so redirect to home page
  window.addEventListener('load', function () {
  const isSignedIn = isLoggedIn();
  if(isSignedIn){
    window.location='home.html';
  }
  async function apiStatus() {
  let response = await fetch('https://devicesync-api.theprotondev.repl.co/status');
  const data = await response.text();
  const status_label = document.getElementById("api-status-label")
  status_label.innerText = data
  }
  apiStatus()
  })
</script>

<h3 id="api-status-label" class="d-flex d-sm-flex justify-content-center align-items-center justify-content-sm-center" style="padding-bottom: 500px;font-family: 'Share Tech', sans-serif;color: #A441FF;height: 0px;">API Status: Down | Or Not Accessible</h3>
</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/protonSnippets.js"></script>
    <script src="assets/js/toast.min.js"></script>
</body>

</html>