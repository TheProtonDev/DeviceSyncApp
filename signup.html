<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>DeviceSync</title>
    <meta name="description" content="Cross Platform Multi-Device Clipboard Software">
    <meta name="" content="">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/img/DeviceSync%20Icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/img/DeviceSync%20Icon.png">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Risque&amp;display=swap">
    <link rel="stylesheet" href="assets/css/Sansation.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Share+Tech&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/ionicons.min.css">
    <link rel="stylesheet" href="assets/css/Drag-Drop-File-Input-Upload.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
    <h3 class="d-flex d-sm-flex justify-content-center align-items-center justify-content-sm-center" style="padding-top: 71px;font-family: 'Share Tech', sans-serif;color: #A441FF;">Sign Up</h3>
    <p class="text-center d-flex flex-shrink-1 justify-content-center align-items-center" style="color: rgb(255,255,255);font-family: Sansation;"><span style="text-decoration: underline;">Please input your desired username</span></p>
    <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="loginFormDiv" style="padding-bottom: 15px;">
        <form><input class="form-control" type="text" id="usernameField" placeholder="Username" style="border-radius: 10px;border: none;"><br><input id="passwordField" class="form-control" type="password" placeholder="Password" style="border-radius: 10px;border: none;padding-bottom: 8px;" /></form>
    </div>
    <div class="d-flex d-xl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center" id="CenterButton1"><script>
    async function signUp(){
        // Check if both fields are filled in
        const usernameBox = document.getElementById("usernameField")
        const passwordField = document.getElementById("passwordField")
        // Check if username was input but no email was input
        if (usernameBox.value != "" && passwordField.value != ""){
            // Proceed with login
            // Move on to processing data
            const user = usernameBox.value
            let url = "https://devicesync-api.theprotondev.repl.co/signup?username="+user+"&password="+passwordField.value
            // Check result of json, return request result
            let jsonResult = await (await fetch(url)).json();
            if(jsonResult.Error){
              toast('error', jsonResult.Error);
            }
            else{ // On success
               const username = jsonResult.username
               const auth_token = jsonResult.auth_token

               toast('success', "Welcome, " + username);
               console.log(auth_token)
               document.cookie = "username="+username+'; secure';
               document.cookie = "auth_token="+auth_token+'; secure';
                setTimeout(function () {
                    window.location = 'home.html';
                }, 3000);
            }
        }
        else if(passwordField.value.length != 6){
            toast('error', 'Your password should be 8 or more characters | You Entered '+ passwordField.value.length);
        }
        // If both fields are filled in and hsave sufficient data, proceed with trying to login
        else{
            toast('prompt', 'Processing Data');
            // Move on to processing data using checkLogin()
            let url = "https://devicesync-api.theprotondev.repl.co/signup?username="+user+"&password="+passwordField.value
            // Check result of json, return request result
            let jsonResult = await (await fetch(url)).json();
            if(jsonResult.Error){
              toast('error', jsonResult.Error);
            }
            else{ // On success
               const username = jsonResult.username
               const auth_token = jsonResult.auth_token
               var expiryDate = new Date();
               expiryDate.setMonth(expiryDate.getMonth() + 1);
               toast('success', "Welcome Back, " + username);
               console.log(auth_token)
               document.cookie = 'username='+username+'; SameSite=None; Secure; expires='+expiryDate.toGMTString()
               document.cookie = "auth_token="+auth_token+'; SameSite=None; Secure; expires='+expiryDate.toGMTString()

            }
        }
    }
</script>
<button id="signInBTN" class="btn btn-primary btn-grad align-self-sm-center" onclick="signUp()" type="button">Sign Up</button>
</div><br>
    <div class="d-flex justify-content-center align-items-center" id="CenterButton2"><button class="btn btn-primary btn-grad" type="button" onclick="window.location=&#39;index.html&#39;">Back</button></div>
    <footer style="padding-top: 167px;"><script>
  // Wait till the site is loaded, once loaded check api status, also check if user signed in, if not redirect to index page
  window.addEventListener('load', function () {
    // Check if the user is signed in
    isLoggedIn();
    isAPIUp();
  })
</script>
</footer>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/protonSnippets.js"></script>
    <script src="assets/js/toast.min.js"></script>
</body>

</html>