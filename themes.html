<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>DeviceSync</title>
    <meta name="description" content="Cross Platform Multi-Device Clipboard Software">
    <meta name="" content="">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/img/DeviceSync%20Icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/img/DeviceSync%20Icon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Risque&amp;display=swap">
    <link rel="stylesheet" href="assets/css/Sansation.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Share+Tech&amp;display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="assets/css/Drag-Drop-File-Input-Upload.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
    <div id="ifLoggedin" style="/*display: none;*//*visibility: hidden;*/">
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-end align-items-center justify-content-xl-end align-items-xl-center justify-content-xxl-end align-items-xxl-center" id="center-1" style="padding-bottom: 15px;padding-top: 11px;padding-right: 9px;"><script>
  function logout(){
    removeCookies();
    window.location='index.html';
  }
</script>
<button class="btn btn-primary btn-grad" onclick="logout()" type="button">Logout</button>
</div>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-3" style="padding-top: 20px;color: var(--secondary);padding-bottom: 20px;">
            <h3 class="d-flex d-sm-flex justify-content-center align-items-center justify-content-sm-center" style="font-family: 'Share Tech', sans-serif;color: var(--accent);">Theming</h3>
        </div>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-6" style="padding-bottom: 15px;padding-top: 15px;"><script>
window.addEventListener('load', function () {
  const fileInput = document.getElementById('themeUpload');
  fileInput.onchange = () => {
    const selectedFile = fileInput.files[0];
    const formData = new FormData()
    formData.append('file', selectedFile)
    // Load the json file
    var readFile = new FileReader();
    readFile.onload = function(e) {
      var contents = e.target.result;
      var json = JSON.parse(contents);
      if(parseTheme(json)){
          // On success of all this, then confirm the user wants to set the theme
          toast('success', "Please confirm whether or not you'd like to set this theme");

          // Before unhiding divs, set title field text
          var chosenThemeName = document.getElementById("chosenThemeName");
          document.getElementById("chosenThemeName").innerText = "Theme Chosen: "+json.theme_name

          // Make previously hidden divs now visible7
          var div = document.getElementById("confirmDiv");
          div.style = 'display:block;visibility:visible;';
          var div = document.getElementById("themeTItle");
          div.style = 'display:block;visibility:visible;';
          var otherDiv = document.getElementById("confirmOptions");
          otherDiv.style = 'display:block;visibility:visible;';
      }
      else{
        toast('error', "Uploaded theme is not of valid format");
      }
      // Now that the json contents are parsed, apply the theme
      // Firstly check what options are required by checking what options are input


    }
  readFile.readAsText(selectedFile);
};

})
</script>

<input id='themeUpload' type="file" accept=".json" required style="display: none;" />
<button class="btn btn-primary btn-grad" type="button" onclick="$('#themeUpload').trigger('click')">Upload Theme</button>
</div>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="themeTItle" style="display: none;visibility: hidden;">
            <h4 id="chosenThemeName" style="color: var(--secondary);text-align: center;">Theme Chosen:<br><br></h4>
        </div>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-10" style="padding-bottom: 15px;padding-top: 15px;"></div>
    </div>
    <div class="d-xl-flex justify-content-xl-center align-items-xl-center" id="confirmDiv" style="display: none;visibility: hidden;"><script>
async function confirmTheme(){
  const onAllDevices = document.getElementById('onAllDevices');
  const uploadToRepo = document.getElementById('uploadToRepo');
  // Set the theme, then process parameters
  const fileInput = document.getElementById('themeUpload');
  const selectedFile = fileInput.files[0];
  // Load the json file
  var readFile = new FileReader();
  readFile.onload = async function(e) {
  var contents = e.target.result;
  var json = JSON.parse(contents);
  // Now that json is retrieved, set theme fully
  setTheme(json);
  // Now process parameters
  if(onAllDevices.checked){
    let url = 'https://devicesync-api.theprotondev.repl.co/settheme?username='+getCookie("username")+"&auth_token="+getCookie("auth_token")+'&theme='+getCookie("theme");
    // Make request to set latest theme
    let response = await fetch(url);
  }
  toast('success', "Theme Set!");
  setTimeout(function () {
      window.location = 'home.html';
  }, 3000);
}
  readFile.readAsText(selectedFile);
}
</script>
<button class="btn btn-success" type="button" onclick="confirmTheme()">Confirm Changes</button><button class="btn btn-danger" type="button" onclick="window.location=&#39;home.html&#39;">Discard Changes</button></div>
    <div class="d-xl-flex justify-content-xl-center align-items-xl-center" id="spacer" style="/*display: none;*//*visibility: hidden;*/padding-bottom: 19px;"></div>
    <div class="d-xl-flex justify-content-xl-center align-items-xl-center" id="confirmOptions" style="display: none;visibility: hidden;">
        <form class="d-sm-flex justify-content-sm-center align-items-sm-center">
            <div class="form-check"><input class="form-check-input" type="checkbox" id="onAllDevices"><label class="form-check-label" for="formCheck-1" style="color: var(--secondary);padding-bottom: 13px;">Set Theme For Account On<br>All Devices</label></div>
            <div class="form-check" style="display: none;visibility: hidden;"><input class="form-check-input" type="checkbox" id="uploadToRepo"><label class="form-check-label" for="formCheck-3" style="color: var(--secondary);padding-bottom: 13px;">Upload To DeviceSync<br>Public Theme Repo</label></div>
        </form>
    </div>
    <div class="d-xl-flex justify-content-xl-center align-items-xl-center" id="confirmOptions-1" style="/*display: none;*//*visibility: hidden;*/">
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-4" style="display: none;visibility: hidden;"><button class="btn btn-primary btn-grad" type="button" onclick="showThemeRepo()">Browse Themes</button></div>
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-9" style="padding-bottom: 15px;"></div><script>
function showThemeRepo(){
  var div = document.getElementById("ifLoggedin");
  div.style = 'display:block;visibility:visible;';
  // Set content div visible if any themes are available
}
</script>

    </div>
    <div class="d-xl-flex justify-content-xl-center align-items-xl-center" id="confirmOptions-3" style="/*display: none;*//*visibility: hidden;*/">
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-5" style="padding-bottom: 15px;">
            <div class="card" style="background: rgba(255,255,255,0);display: none;visibility: hidden;">
                <div class="card-body">
                    <h4 class="card-title" style="color: var(--accent);">Title</h4>
                    <h6 class="card-title" style="color: var(--secondary);">Made By&nbsp;</h6>
                    <p class="card-text" style="color: var(--secondary);">Nullam id dolor id nibh ultricies vehicula ut id elit. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus.</p>
                    <form>
                        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-7" style="padding-bottom: 15px;"><button class="btn btn-primary btn-grad" type="button" onclick="">Preview</button></div>
                        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-8" style="padding-bottom: 15px;"><button class="btn btn-primary btn-grad" type="button" onclick="">Set</button></div>
                    </form>
                </div>
            </div>
        </div><script>
function showThemeRepo(){
  var div = document.getElementById("ifLoggedin");
  div.style = 'display:block;visibility:visible;';
  // Set content div visible if any themes are available
}
</script>

    </div>
    <div class="d-xl-flex justify-content-xl-center align-items-xl-center" id="confirmOptions-2" style="/*display: none;*//*visibility: hidden;*/">
        <div class="d-flex d-xl-flex d-xxl-flex justify-content-center align-items-center justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center" id="center-2" style="padding-bottom: 15px;"><button class="btn btn-primary btn-grad" type="button" onclick="window.location=&#39;home.html&#39;">Back</button></div>
    </div>
    <div id="ifNotloggedin" style="display: none;visibility: hidden;"><h3 class="text-center d-flex d-sm-flex justify-content-center align-items-center justify-content-sm-center" style="padding-top: 71px;font-family: 'Share Tech', sans-serif;color: #ff0000;">Hm, You're not supposed to be here<br />Redirecting In 3 Seconds...</h3>
</div>
    <footer style="padding-top: 167px;"><script>
  // Wait till the site is loaded, once loaded check api status, also check if user signed in, if not redirect to index page
  window.addEventListener('load', function () {
    // Check if the user is signed in
    isLoggedIn();
    isAPIUp();
    checkForTheme();
  })
</script>
</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/protonSnippets.js"></script>
    <script src="assets/js/toast.min.js"></script>
</body>

</html>